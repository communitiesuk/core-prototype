{# Common macros #}
{% macro heading(heading, caption, size="l", headingLevel="1") %}
<h{{ headingLevel }} class="govuk-heading-{{ size }}">
  {% if caption %}<span class="govuk-caption-{{ size }}">{{ caption }}</span>{% endif %}
  {{ heading | noOrphans | safe }}
</h{{ headingLevel }}>
{% endmacro %}

{% macro fieldsetHeading(heading, caption, size="l", headingLevel="1") %}
<h{{ headingLevel }} class="govuk-fieldset__heading">
  {% if caption %}<span class="govuk-caption-{{ size }}">{{ caption }}</span>{% endif %}
  {{ heading | noOrphans | safe }}
</h{{ headingLevel }}>
{% endmacro %}

{% macro notificationBannerText(success, object) %}
  {{ (object + " has been invited to submit CORE data.") if success == "invited" }}
  {{ (object + " has been deactivated.") if success == "deactivated" }}
  {{ "User has been deleted." if success == "deleted" }}
  {{ ("An invitation to submit CORE data has been resent to " + object + ".") if success == "reinvited" }}
  {{ ("Log " + object + " has been submitted") if success == "submitted" }}
{% endmacro %}

{% macro entityHtml(title, href, caption) %}
  {% if href %}
    <a class="govuk-link govuk-!-font-weight-bold" href="{{ href }}">{{ title }}</a>
  {% else %}
    {{ title }}
  {% endif %}
  {% if caption %}
    <br><span class="govuk-!-font-weight-regular app-!-colour-muted">{{ caption }}</span>
  {% endif %}
{% endmacro %}

{# Postcode answer witjh inferred local authority #}
{% macro postcodeHtml(postcode, localauthority) %}
  {{ postcode | upper }}
  <br><span class="govuk-!-font-weight-regular app-!-colour-muted">{{ localauthority }}</span>
{% endmacro %}

{# User macros #}
{% macro userLastActiveHtml(user) %}
  {% if user.deactivated %}
    <span class="app-!-colour-muted">Deactivated</span>
  {% elif user.lastActive %}
    {{ user.lastActive | govukDate }}
  {% else %}
    Not logged in yet
    {% if isAdmin or isCoordinator %}
      <br><a href="/organisations/{{ user.organisationId }}/users?success=reinvited&#38;userId={{ user.id }}">Resend invitation email</a>
    {% endif %}
  {% endif %}
{% endmacro %}

{% macro localAuthoritiesHtml(localAuthorities, areas) %}
  {% if areas | length > 1 %}
    <ul class="govuk-list govuk-list--bullet">
    {% for gss in areas %}
      {% set localAuthority = localAuthorities | where("gss", gss) | first %}
      <li>{{ localAuthority.name }}</li>
    {% endfor %}
    </ul>
  {% elif areas | length == 1 %}
    {% set localAuthority = localAuthorities | where("gss", areas[0]) | first %}
    {{ localAuthority.name }}
  {% else %}
    None
  {% endif %}
{% endmacro %}

{# Admin macros #}
{% from "components/sub-navigation/macro.njk" import appSubNavigation %}
{% macro adminNavigation(title) %}
  {{ heading(thisOrganisation.name) }}
  {{ appSubNavigation({
      items: [{
      href: thisOrganisationPath + "/logs",
      text: "Logs",
      active: path.startsWith(thisOrganisationPath + "/logs")
    }, {
      href: thisOrganisationPath + "/schemes",
      text: "Supported services",
      active: path.startsWith(thisOrganisationPath + "/schemes")
    }, {
      href: thisOrganisationPath + "/users",
      text: "Users",
      active: path.startsWith(thisOrganisationPath + "/users")
    }, {
      href: thisOrganisationPath,
      text: "About this organisation",
      active: path == thisOrganisationPath
    }]
  }) }}
  <h2 class="govuk-visually-hidden">{{ title }}</h2>
{% endmacro %}

{% macro organisationRelationshipHtml(organisations, organisation, type) %}
  {% if organisation[type] | length > 1 %}
    <ul class="govuk-list govuk-list--bullet">
    {% for parentId in organisation[type] %}
      <li>{{ organisations[parentId].name }}</li>
    {% endfor %}
    </ul>
  {% elif organisation[type] | length == 1 %}
    {{ organisations[organisation[type][0]].name }}
  {% else %}
    None
  {% endif %}
{% endmacro %}

{# Collection resources #}
{% from "components/document-list/macro.njk" import appDocumentList %}
{% macro collectionResouces(classes) %}
  {{ appDocumentList({
    classes: classes,
    items: [{
      href: "/public/files/privacy-notice.pdf",
      text: "DLUHC privacy notice",
      metadata: "PDF, 171 KB, 1 page",
      description: "You must show this privacy notice to tenants and buyers before you can submit logs containing information about them."
    }, {
      href: "/public/files/paper-form-social-housing-letting.pdf",
      text: "Lettings log for tenants",
      metadata: "PDF, 666 KB, 4 pages"
    }, {
      href: "#",
      text: "Lettings bulk upload specification",
      metadata: "CSV, 32 KB"
    }, {
      href: "#",
      text: "Lettings bulk upload template",
      metadata: "CSV, 12 KB"
    }, {
      href: "/public/files/paper-form-social-housing-sale.pdf",
      text: "Sales log for buyers",
      metadata: "PDF, 690 KB, 5 pages"
    }, {
      href: "#",
      text: "Sales bulk upload specification",
      metadata: "CSV, 27 KB"
    }, {
      href: "#",
      text: "Sales bulk upload template",
      metadata: "CSV, 9 KB"
    }]
  }) }}
{% endmacro %}
