{% extends "layouts/question.njk" %}

{% import "macros.njk" as macro %}

{% set title = "Which providers manage properties for this organisation?" %}
{% set caption = organisation.name %}
{% set required = true %}

{% if organisation.agents %}
  {# Editing an existing organisation #}
  {% set buttonText = "Continue" %}
  {% set formAction = organisationPath + "/check-updated-answers" %}
{% endif %}

{% macro addAnotherAgent(index, items) %}
  {% call appAddAnother({
    items: items
  }) %}
    {{ appAutocomplete(decorate({
      formGroup: {
        classes: "govuk-!-margin-bottom-1"
      },
      label: {
        text: "Name of managing agent"
      },
      allowEmpty: true,
      showNoOptionsFound: true,
      items: organisations | optionItems
    }, ["organisations", organisation.id, "agents", index])) }}
  {% endcall %}
{% endmacro %}

{% block question %}
  <h1 class="govuk-heading-l app-add-another__heading" tabindex="-1">
    <span class="govuk-caption-l">{{ caption }}</span>
    {{ title | noOrphans | safe }}
  </h1>

  <div data-module="add-another">
    {% for agent in organisation.agents %}
      {{ addAnotherAgent(loop.index0, organisation.agents) }}
    {% else %}
      {{ addAnotherAgent(0, organisation.agents) }}
    {% endfor %}

    {{ govukButton({
      classes: "govuk-button--secondary app-add-another__add-button",
      text: "Add another managing agent"
    }) }}
  </div>
{% endblock %}
